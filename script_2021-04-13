getwd()
setwd("C:/Users/Jordan/Documents/Université de Sherbrooke/Session 5 (H-21)/Méthodes en écologie computationnelle")

# INSTALLER LE PACKAGE SQLITE
install.packages('RSQLite')
library(RSQLite)

# OUVRIR LA CONNECTION 
con <- dbConnect(SQLite(), dbname="projetspikee.db")

# CRÉER LA TABLE NOEUDS
noeuds_sql <- '
  CREATE TABLE noeuds (
  nom_prenom VARCHAR(50),
  annee_debut DATE,
  session_debut CHAR(1),
  programme VARCHAR(50),
  coop BOLEAN,
  bio500 BOLEAN,
  PRIMARY KEY (nom_prenom)
);'

dbSendQuery(con, noeuds_sql)

# CRÉER LA TABLE COLLABORATIONS
collaborations_sql <- '
  CREATE TABLE collaborations (
  etudiant1 VARCHAR(50),
  etudiant2 VARCHAR(50),
  sigle CHAR(6),
  session CHAR(3),
  PRIMARY KEY (etudiant1, etudiant2, sigle, session),
  FOREIGN KEY (etudiant1) REFERENCES noeuds(nom_prenom),
  FOREIGN KEY (etudiant2) REFERENCES noeuds(nom_prenom),
  FOREIGN KEY (sigle) REFERENCES cours(sigle)
);'

dbSendQuery(con, collaborations_sql)

# CRÉER LA TABLE COURS
cours_sql <- '
  CREATE TABLE cours (
  sigle CHAR(6) NOT NULL,
  credits INTEGER NOT NULL,
  obligatoire BOLEAN,
  laboratoire BOLEAN,
  distance BOLEAN,
  groupe BOLEAN,
  libre BOLEAN,
  PRIMARY KEY (sigle, distance)
);'

dbSendQuery(con, cours_sql)

dbListTables(con)

# SI BESOIN DE SUPPRIMER UNE TABLE
dbSendQuery(con,"DROP TABLE collaborations;")

# LECTURE DES FICHIERS CSV
data_noeuds <- read.csv(file = "all_noeuds.csv", sep = ",", fileEncoding = "UTF-8-BOM")
data_collaborations <- read.csv(file="all_collaborations.csv", sep = ",", fileEncoding = "UTF-8-BOM")
data_cours <- read.csv(file = "all_cours.csv", sep = ",", fileEncoding = "UTF-8-BOM")

# ENLEVER LES DOUBLONS
db_noeuds <- unique(data_noeuds,incomparables= FALSE)
db_collaborations <- unique(data_collaborations,imcomparable=FALSE)
db_cours <- unique(data_cours,incomparable=FALSE)

# INJECTION DES DONNÉES DANS LES TABLES
dbWriteTable(con, append = TRUE, name = "noeuds", value = db_noeuds, row.names = FALSE)
dbWriteTable(con, append = TRUE, name = "collaborations", value = db_collaborations, row.names = FALSE)
dbWriteTable(con, append = TRUE, name = "cours", value = db_cours, row.names = FALSE)

# VÉRIFIER L'INJECTION DES DONNÉES POUR LES 3 TABLES
sql_requete <- "
SELECT nom_prenom, annee_debut, session_debut, programme, coop, bio500
  FROM noeuds LIMIT 10
;"
etudiants <- dbGetQuery(con, sql_requete)
etudiants

sql_requete2 <- "
SELECT etudiant1, etudiant2, sigle, session
  FROM collaborations LIMIT 10
;"
collab <- dbGetQuery(con, sql_requete2)
collab

sql_requete3 <- "
SELECT sigle, credits, obligatoire, laboratoire, distance, groupe, libre
  FROM cours LIMIT 10
;"
cours <- dbGetQuery(con, sql_requete3)
cours
